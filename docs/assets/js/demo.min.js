!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(t){t.exports=JSON.parse('{"BUILDINGS":{"TYPES":["commercial","residential"],"SIZE":3},"GRID":{"size":9},"CHUNK":{"size":162}}')},,function(t,e,s){"use strict";s.r(e);const i={};i.DEGREES=180/Math.PI,i.radiansToDegrees=t=>t*i.DEGREES,i.degreesToRadians=t=>t*i.DEGREES;var r=i;class n{static instanceofVector(t){if(!t instanceof a){throw new TypeError("Arg is not an instance of Vector2D, input type was "+typeof t)}}static validate(...t){t.forEach(t=>{n.instanceofVector(t)})}}class a{setX(t){return this._x=t,this}getX(){return this._x}setY(t){return this._y=t,this}getY(){return this._y}set(t,e){return this.setX(t),this.setY(e),this}static fromArray(t=[]){if(t=t||[],!Array.isArray(t))throw new TypeError(`Vector.fromArray() arg is not an array, type was '${typeof t}'`);return new a(t[0]||0,t[1]||0)}static fromObject(t){return new a((t=t||{}).x||0,t.y||0)}constructor(t=0,e=0){this.setX(t),this.setY(e)}add(t){return n.validate(t),this.setX(this.getX()+t.getX()),this.setY(this.getY()+t.getY()),this}addX(t){return this.setX(this.getX()+t),this}addY(t){return this.setY(this.getY()+t),this}static add(t,e){return n.validate(t,e),new a(t.getX()+e.getX(),t.getY()+e.getY())}static addX(t,e){return n.validate(t,e),new a(t.getX()+e.getX(),t.getY())}static addY(t,e){return n.validate(t,e),new a(t.getX(),t.getY()+e.getY())}addScalar(t){return this.addX(t),this.addY(t),this}static addScalar(t,e){return n.validate(t),t.addX(e),t.addY(e),t}substractScalarX(t){return this.setX(this.getX()-t),this}substractScalarY(t){return this.setY(this.getY()-t),this}substract(t){return n.validate(t),this.substractScalarX(t.getX()),this.substractScalarY(t.getY()),this}static substract(t,e){return n.validate(t,e),new a(t.getX()-e.getX(),t.getY()-e.getY())}multiply(t){return n.validate(t),this.multiplyX(t),this.multiplyY(t),this}multiplyScalar(t){return this.setX(this.getX()*t),this.setY(this.getY()*t),this}multiplyX(t){return n.validate(t),this.setX(this.getX()*t.getX()),this}multiplyY(t){return n.validate(t),this.setY(this.getY()*t.getY()),this}static multiply(t,e){return n.validate(t,e),new a(t.getX()*e.getX(),t.getY()*e.getY())}divide(t){return n.validate(t),this._x=this.getX()/t.getX(),this._y=this.getY()/t.getY(),this}divideScalar(t){return this.setX(this.getX()/t),this.setY(this.getY()/t),this}divideScalarX(t){const e=this.getX()/t;return this.setX(e),this}divideScalarY(t){return this.setY(this.getY()/t),this}static divide(t,e){return n.validate(t,e),new a(t.getX()/e.getX(),t.getY()/e.getY())}dot(t){return n.validate(t),this.getX()*t.getX()+this.getY()*t.getY()}static dot(t,e){return n.validate(t,e),t.getX()*e.getX()+t.getY()*e.getY()}cross(t){return n.validate(t),this.getX()*t.getY()-this.getY()*t.getX()}static cross(t,e){return n.validate(t,e),t.getX()*e.getY()-t.getY()*e.getX()}magnitude(){return Math.sqrt(this.dot(this))}static magnitude(t,e){return n.validate(t,e),Math.sqrt(a.dot(t,e))}magnitudeSq(){return Math.pow(this.getX(),2)+Math.pow(this.getY(),2)}static magnitudeSq(t){return n.validate(t),Math.pow(t.getX(),2)+Math.pow(t.getY(),2)}horizontalAngle(){return Math.atan2(this.getY(),this.getX())}angle(){return this.horizontalAngle()}rotate(t){return this._x=this.getX()*Math.cos(t)-this.getY()*Math.sin(t),this._y=this.getX()*Math.sin(t)+this.getY()*Math.cos(t),this}rotateDegrees(t){return this.rotate(r.degreesToRadians(t)),this}rotateBy(t){return this.rotate(this.angle()+t)}rotateByDegrees(t){return this.rotateBy(this.angle()+r.radiansToDegrees(t))}xlt(t){return this.getX()<t.getX()}ylt(t){return this.getY()<t.getY()}lt(t){return this.xlt(t)&&this.ylt(t)}xle(t){return this.getX()<=t.getX()}yle(t){return this.getY()<=t.getY()}le(t){return this.xle(t)&&this.yle(t)}xgt(t){return this.getX()>t.getX()}ygt(t){return this.getY()>t.getY()}gt(t){return this.xgt(t)&&this.ygt(t)}xge(t){return this.getX()>=t.getX()}yge(t){return this.getY()>=t.getY()}ge(t){return this.xle(t)&&this.yle(t)}clamp(t,e,s=!0){return n.validate(t),n.validate(e),s?(this.getX()<t.getX()&&this.setX(t.getX()),this.getX()>e.getY()&&this.setX(e.getY()),this.getY()<t.getY()&&this.setY(t.getY()),this.getY()>e.getY()&&this.setY(e.getY())):(this.getX()<=t.getX()&&this.setX(t.getX()),this.getX()>=e.getY()&&this.setX(e.getY()),this.getY()<=t.getY()&&this.setY(t.getY()),this.getY()>=e.getY()&&this.setY(e.getY())),this}clone(){return new a(this.getX(),this.getY())}toArray(){return[this.getX(),this.getY()]}toString(t=","){return this.toArray().join(t)}toObject(){return{x:this.getX(),y:this.getY()}}round(){this.setX(Math.round(this._x)),this.setY(Math.round(this._y))}floor(){this.setX(Math.floor(this._x)),this.setY(Math.floor(this._y))}copy(t){return n.validate(t),this.setX(t.getX()),this.setY(t.getY()),this}equals(t){return n.validate(t),this.getX()===t.getX()&&this.getY()===t.getY()}static equals(t,e){return n.validate(t,e),t.getX()===e.getX()&&t.getY()===e.getY()}zero(){return this.setX(0),this.setY(0),this}static zero(t){n.validate(t),t._x=0,t._y=0}isZero(){return 0===this.getX()&&0===this.getY()}static isZero(t){return n.validate(t),0===t.getX()&&0===t.getY()}length(){return this.magnitude()}static length(t,e){return n.validate(t,e),a.magnitude(t,e)}negative(){return this.setX(-this.getX()),this.setY(-this.getY()),this}negativeX(){return this.setX(-this.getX()),this}negativeY(){return this.setY(-this.getY()),this}static negative(t){return n.validate(t),new a(-t.getX(),-t.getY())}distanceX(t){return n.validate(t),this.getX()-t.getX()}distanceAbs(t){return n.validate(t),new a(this.distanceXAbs(t),this.distanceYAbs(t))}distanceXAbs(t){return n.validate(t),Math.abs(this.distanceX(t))}distanceY(t){return n.validate(t),this.getY()-t.getY()}distanceYAbs(t){return n.validate(t),Math.abs(this.distanceY(t))}distance(t){return n.validate(t),Math.sqrt(this.distanceSq(t))}distanceSq(t){return n.validate(t),this.distanceX(t)*this.distanceX(t)+this.distanceY(t)*this.distanceY(t)}normalize(){const t=this.length();return 0===t?(this.setX(1),this.setY(0)):this.divide(new a(t,t)),this}}class o extends a{getRed(){return super.getX()}getGreen(){return super.getY()}getBlue(){return this._z}setZ(t){this._z=t}getZ(){return this._z}constructor(t=0,e=0,s=0){super(t,e),this._z=s,this.clamp(new a(0,0),new a(256,256))}equals(t){return super.equals(t)&&this._z===t.getZ()}clamp(t,e,s=!0){return super.clamp(t,e,s),!0===s&&(this.getZ()<t.getX()&&this.setZ(t.getX()),this.getZ()>e.getY()&&this.setZ(e.getY())),this}}class h{getTransparencyColor(){return this._transparentColor}get imgData(){return this._imgData}constructor(t,e=null,s=null){this._imgData=t,this._origin=e||0,this._transparentColor=null}setTransparencyColor(t,e,s){this._transparentColor=new o(t,e,s)}resetTransparencyColor(){return this._transparentColor=null,this}hasTransparencyColor(){return!(null===this._transparentColor)}applyTransparency(){if(this.hasTransparencyColor())for(let t=0;t<this._imgData.data.length;t+=4){const e=new o(this._imgData.data[t],this._imgData.data[t+1],this._imgData.data[t+2]);this.getTransparencyColor().equals(e)&&(this._imgData.data[t+3]=0)}}validateOrigin(){return this._validateOrigin(this._origin)}_validateOrigin(t){return!!(Number.isInteger(t)&&t<=7)}setOrigin(t=0){if(!this._validateOrigin(t))throw`origin ${t} : MUST BE AN INTEGER (is ${typeof t}) lower or equal than 7.`;this._origin=t}getCenter(){const t=this._imgData.width%2!=0?this._imgData.width-1:this._imgData.width,e=this._imgData.height%2!=0?this._imgData.height-1:this._imgData.height;switch(this._origin){case 0:return new a(0,0);case 1:return new a(t/2,0);case 2:return new a(t,0);case 3:return new a(t,e/2);case 4:return new a(t,e);case 5:return new a(t/2,e);case 6:return new a(0,e);case 7:return new a(0,e/2);default:throw`this._origin=${this._origin} : MUST BE AN INTEGER lower or equal than 7. Use Sprite.setOrigin() !`}}}class g extends h{getLoopDuration(){return this._loopDuration}getCurrentFrame(){return this._currentFrame}constructor(t,e,s=0){super(t[0]),this._map=t,this._loopDuration=e,this._currentFrame=s}step(){this._currentFrame+=1,this._currentFrame>this._map.length-1&&(this._currentFrame=0),this._imgData=this._map[this._currentFrame]}}class l{getCtx(t=null,e={}){}_clear(t){}draw(...t){this.getCtx().save(),this._clear(t),this._draw(t),this.getCtx().restore()}_draw(t){}setSmoothing(t=!0){this.getCtx().mozImageSmoothingEnabled=t,this.getCtx().webkitImageSmoothingEnabled=t,this.getCtx().msImageSmoothingEnabled=t,this.getCtx().imageSmoothingEnabled=t}}class u extends l{getCtx(t="2d",e={alpha:!0}){return this._canvas.getContext(t,e)}constructor(t){super(),this._canvas=t}_clear(...t){this.getCtx().clearRect(0,0,this._canvas.width,this._canvas.height)}_draw(...t){}}class c extends l{getCtx(t="2d",e={alpha:!0}){return this._offScreen.getContext(t,e)}getOffScreenImageBitmap(){return this._offScreen.transferToImageBitmap()}drawOffScreenCanvas(t="2d",e={alpha:!0}){this.getCtx(t).drawImage(this._image,0,0)}constructor(t,e,s=!0){super(),this._canvas=t,this._offScreen=new OffscreenCanvas(e.width,e.height),this._image=e,s&&this.drawOffScreenCanvas()}_draw(...t){this._canvas.getContext("bitmaprenderer").transferFromImageBitmap(this.getOffScreenImageBitmap())}}class d{getSpritesMap(){return this._spritesMap}get(t){return this._spritesMap.get(t)}constructor(t,e){this._json=t,this._context=e,this._spritesMap=new Map,this._build()}_buildSprite(t){if(!Array.isArray(t.dimensions))throw"Json dimensions entry MUST BE AN array is `${type of value.dimensions}`";if(void 0===t.dimensions[0]||void 0===t.dimensions[1])throw"Json dimension[0] or Json dimension[1] is mandatory";const e=this._context.getImageData(t.origin[0],t.origin[1],t.dimensions[0],t.dimensions[1]),s=new h(e);return null!=t.transparency&&s.setTransparencyColor(t.transparency[0],t.transparency[1],t.transparency[2]),s}_build(){const t=this._json.tiles,e=this._json.animations;if(void 0!==t)for(let[e,s]of Object.entries(t))this._spritesMap.set(e,this._buildSprite(s));if(void 0!==e)for(let[t,s]of Object.entries(e)){const e=s.loopDuration,i=s.tiles,r=[];i.forEach(t=>{r.push(this.get(t).imgData)});const n=new g(r,e);this.getSpritesMap().set(t,n)}}}class m{static image(t){return new Promise((e,s)=>{const i=new Image;i.addEventListener("load",()=>e(i)),i.addEventListener("error",t=>s(t)),i.src=t})}static json(t){return fetch(t).then(t=>t.json()).catch(t=>t)}}class w{getNeighbors(t){return new Map([["N",this.getNorth(t)],["NW",this.getNorthWest(t)],["W",this.getWest(t)],["SW",this.getSouthWest(t)],["S",this.getSouth(t)],["SE",this.getSouthEast(t)],["E",this.getEast(t)],["NE",this.getNorthEast(t)]])}getNorth(t,e=1){throw"Do not instanciate me !"}getNorthEast(t,e=1){throw"Do not instanciate me !"}getEast(t,e=1){throw"Do not instanciate me !"}getSouthEast(t,e=1){throw"Do not instanciate me !"}getSouth(t,e=1){throw"Do not instanciate me !"}getSouthWest(t,e=1){throw"Do not instanciate me !"}getWest(t,e=1){throw"Do not instanciate me !"}getNorthWest(t,e=1){throw"Do not instanciate me !"}}class p extends w{getNorth(t,e=1){return a.add(t.clone(),new a(0,-1*e))}getNorthEast(t,e=1){return a.add(t.clone(),new a(e,-1*e))}getEast(t,e=1){return a.add(t.clone(),new a(e,0))}getSouthEast(t,e=1){return a.add(t.clone(),new a(e,e))}getSouth(t,e=1){return a.add(t.clone(),new a(0,e))}getSouthWest(t,e=1){return a.add(t.clone(),new a(-1*e,e))}getWest(t,e=1){return a.add(t.clone(),new a(-1*e,0))}getNorthWest(t,e=1){return a.add(t.clone(),new a(-1*e,-1*e))}}class Y extends u{getGenerator(t){return t.getCells().getGenerator()}getCoordinatesAdapter(){return this._coordinateAdapter}constructor(t,e){super(t),this._coordinateAdapter=e}cellToCanvasCoordinates(t,e){return!1!==t&&class{static toCanvas(t,e,s){s=s%2!=0?s-1:s;let i=(e=e%2!=0?e-1:e)*t.getIndex().getX(),r=s*t.getIndex().getY();return t.getIndex().getY()%2!=0&&(i+=e/2),r-=t.getIndex().getY()*(s/2),new a(i,r)}}.toCanvas(t,e.width,e.height)}isDrawable(t=null){return!0}drawImageBitmap(t,e=null){const s=e||new a;this.getCtx().drawImage(t,s.getX(),s.getY())}_draw([t,e]){createImageBitmap(e.imgData).then(e=>{const s=t.getGenerator();for(let t of s){const s=this.cellToCanvasCoordinates(t,e);this.isDrawable(t)&&this.drawImageBitmap(e,s)}})}}class f extends Y{coordinatesToCanvas(t,e=null){new a(32,16);const s=new a(212,178),i=16*(t.getIndex().getX()-t.getIndex().getY())+s.getX(),r=8*(t.getIndex().getX()+t.getIndex().getY())+s.getY();return new a(i,r)}_draw([t,e]){createImageBitmap(e.imgData).then(e=>{const s=t.getGenerator();for(const t of s){const s=this.coordinatesToCanvas(t);this.isDrawable(t)&&this.drawImageBitmap(e,s)}})}}class _ extends class extends class{getIndex(){return this._index}isEvenRow(){return this._index.getY()%2==0}isOddRow(){return!this.isEvenRow()}isEvenCol(){return this._index.getX()%2==0}isOddCol(){return!this.isEvenCol()}constructor(t){this._index=t}}{}{getSize(){return this._size}setSize(t){this._size=t}getType(){return this._type}setType(t){this._type=t}constructor(t,e=null,s=null){super(t),this._type=e,this._size=s}}class X extends Y{coordinatesToCanvas(t,e=null){new a(32,16);const s=new a(212,178),i=16*(t.getIndex().getX()-t.getIndex().getY())+s.getX(),r=8*(t.getIndex().getX()+t.getIndex().getY())+s.getY();return new a(i,r)}_draw([t,e]){createImageBitmap(t.imgData).then(s=>{const i=this.coordinatesToCanvas(e),r=e.getSize(),n=s.height%2==0?s.height-16:s.height-1-16,o=s.width%2==0?s.width-8:s.width-1-8;console.log(o,n,t.imgData);const h=new a(32,16);i.substractScalarX(r*(h.getY()/2));const g=t.imgData.height-r*h.getY()-r;console.log(g),i.substractScalarY(g),this.isDrawable(e)&&this.drawImageBitmap(s,i)})}}class y extends class{setDefaultValue(t){this._defaultCellValue=t}fill(t){"function"==typeof this._fnFill&&(this._rows=this._defaultCellValue,this._fnFill=t,this.setRows())}setRows(){const t=new Array(this._dimensions.getY()).fill(this._defaultCellValue);Object.seal(t);for(let e=0;e<t.length;e++){let s=[];for(let t=0;t<this._dimensions.getX();t++)"function"==typeof this._fnFill&&s.push(this._fnFill.call(this,[t,e]));Object.seal(s),t[e]=s}this._rows=t}constructor(t,e=null,s=null){this._dimensions=t,this._defaultCellValue=e||null,this._fnFill=s||(()=>this._defaultCellValue),this.setRows()}getDimensions(){return this._dimensions}getRow(t,e=0){if(!0===this.hasRow(t)){const s=this._rows[t];return"number"==typeof e&&e<this.getDimensions().getX()?s.slice(e):s}return!1}getRows(){return this._rows}hasRow(t){return void 0!==this._rows[t]}hasCol(t){return void 0!==this._rows[0][t]}hasCell(t,e){return!(!this.hasRow(e)||void 0===this._rows[e][t])}getCell(t,e){if(this.hasCell(t,e))return this._rows[e][t];throw`cell at (${t}, ${e}) is not accessible, max (${this.getDimensions().getX()-1}, ${this.getDimensions().getY()-1})`}getCol(t,e=0){const s=[];let i=0,r=0;for(const e of this._rows){i+=1;for(const i of e)t===r&&s.push(i),r+=1;r=0}return"number"==typeof e&&e<this.getDimensions().getX()?s.slice(e):s}getCellByVector(t){return this.getCell(t.getX(),t.getY())}assertCell(t,e,s){if(this.hasCell(t,e)){const i=this.getCell(t,e);if("function"==typeof s)return!0===s.call(this,i)}return!1}assertCells(t){const e=this.getGenerator();for(const s of e)if("function"==typeof t){if(!0===(!0===t.call(this,s)))return s}return!1}*getGenerator(){for(const t of this._rows)for(const e of t)yield e}}{*getCellByType(){for(const t of this.getGenerator())null!==t.getSize()&&(yield t)}}var v=(t,e)=>t+(e-t+1)*crypto.getRandomValues(new Uint32Array(1))[0]/2**32|0,C=s(0);var S=(t,e)=>{const s=t.getRow(e.getIndex().getY(),e.getIndex().getY()),i=t.getCol(e.getIndex().getX(),e.getIndex().getX());let r=0,n=0;for(const t of s){if(null!==t.getType())break;r+=1}for(const t of i){if(null!==t.getType())break;n+=1}let a=r>n?n:r;a=a>C.BUILDINGS.SIZE?C.BUILDINGS.SIZE:a;const o=v(1,a),h=v(1,2)%2==0?C.BUILDINGS.TYPES[0]:C.BUILDINGS.TYPES[1];e.setSize(o);for(let s=0;s<o;s++)for(let i=0;i<o;i++)s<=o&&i<=o&&t.getCell(e.getIndex().getX()+s,e.getIndex().getY()+i).setType(h)};window.addEventListener("DOMContentLoaded",t=>{const e=document.getElementById("world"),s=m.image("assets/img/tiles.png"),i=m.json("assets/img/tiles.json"),r=m.image("assets/img/infrastructures.png"),n=m.json("assets/img/infrastructures.json"),o=m.image("assets/img/commercials.png"),h=m.json("assets/img/commercials.json");Promise.all([s,i,r,n,o,h]).then(([t,s,i,r,n,o])=>{const h=new c(e,t),g=new d(s,h.getCtx()),l=new a(9,9),u=new y(l,null,([t,e])=>new _(new a(t,e)));for(;!1!==u.assertCells(t=>null===t.getType());){const t=u.assertCells(t=>null===t.getType());S(u,t)}new f(e,new p).draw(u,g.get("tiles-1"));const m=u.getCellByType(),w=new c(e,n),Y=new d(o,w.getCtx()),v=new X(e,new p);u.getCell(3,5).setSize(1),v.draw(Y.get("commercial-1"),u.getCell(3,5)),u.getCell(0,0).setSize(2),v.draw(Y.get("commercial-15"),u.getCell(0,0)),u.getCell(2,0).setSize(2),v.draw(Y.get("commercial-12"),u.getCell(2,0)),u.getCell(6,6).setSize(2),v.draw(Y.get("commercial-13"),u.getCell(6,6)),u.getCell(6,0).setSize(3),v.draw(Y.get("commercial-20"),u.getCell(6,0));for(const t of m);}).catch(t=>{console.log(t)})})}]);